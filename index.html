<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surprivo | Presale-Order Tracking</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=IBM+Plex+Mono:wght@300;500;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- PapaParse -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cream': '#f9f7f2',
                        'paper': '#ffffff',
                        'ink': '#1a1a1a',
                        'gold': '#8a7044',
                        'border-soft': '#e5e1d8',
                    },
                    fontFamily: {
                        display: ['"DM Serif Display"', 'serif'],
                        mono: ['"IBM Plex Mono"', 'monospace'],
                        sans: ['"DM Sans"', 'sans-serif'],
                    },
                    animation: {
                        'reveal-card': 'revealCard 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'fade-in': 'fadeIn 1s ease-out forwards',
                    },
                    keyframes: {
                        revealCard: {
                            '0%': { transform: 'translateY(30px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            background-color: #f9f7f2; 
            color: #1a1a1a;
            background-image: 
                linear-gradient(#e5e1d8 1px, transparent 1px),
                linear-gradient(90deg, #e5e1d8 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: center center;
        }
        .shadow-editorial {
            box-shadow: 0 20px 50px -10px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(0, 0, 0, 0.05);
        }
        .custom-progress {
            transition: width 1.5s cubic-bezier(0.65, 0, 0.35, 1);
        }
        .loader {
            width: 20px; height: 20px;
            border: 2px solid #8a704422;
            border-top-color: #8a7044;
            display: inline-block;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .timeline-item { position: relative; padding-left: 2rem; border-left: 1px solid #e5e1d8; padding-bottom: 2rem; }
        .timeline-item::after {
            content: ''; position: absolute; left: -5px; top: 0;
            width: 9px; height: 9px; border-radius: 50%; background: #e5e1d8;
        }
        .timeline-item.active::after { background: #8a7044; box-shadow: 0 0 0 4px #8a704422; }
        .timeline-item.completed::after { background: #1a1a1a; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start py-12 px-6 font-sans">

    <!-- Header -->
    <header class="text-center mb-12 animate-fade-in">
        <div class="inline-block border-2 border-ink px-8 py-4 mb-6">
            <h1 class="font-display text-6xl md:text-7xl font-normal uppercase tracking-tighter text-ink leading-none">Surprivo</h1>
        </div>
        <div class="flex flex-col items-center">
            <span class="font-mono text-[10px] tracking-[0.6em] uppercase text-gold font-bold">Presale Order Tracking</span>
            <div class="h-10 w-[1px] bg-ink/10 mt-4"></div>
        </div>
    </header>

    <main class="w-full max-w-2xl">
        <!-- Search Section -->
        <div id="auth-section" class="animate-reveal-card">
            <div class="bg-paper p-2 rounded-none border border-ink shadow-editorial mb-8">
                <div class="flex flex-col md:flex-row items-stretch gap-1">
                    <div class="flex-1 flex flex-col justify-center py-2">
                        <input 
                            type="text" 
                            id="orderInput" 
                            placeholder="ENTER YOUR ORDER ID (e.g. #EA-XX-XXXX)"
                            class="bg-transparent px-6 py-3 font-mono text-base md:text-lg focus:outline-none uppercase placeholder:text-ink/20 text-center md:text-left w-full font-bold tracking-tight"
                            onkeypress="if(event.key === 'Enter') trackOrder()"
                        >
                        <span id="inputHint" class="px-6 text-[9px] font-mono text-ink/40 text-center md:text-left uppercase tracking-widest">Found in your confirmation email</span>
                    </div>
                    <button 
                        id="trackBtn"
                        onclick="trackOrder()"
                        class="bg-ink text-cream font-mono px-12 py-5 uppercase tracking-[0.2em] font-bold hover:bg-gold transition-all active:scale-95 text-xs whitespace-nowrap flex items-center justify-center gap-3"
                    >
                        <span>Locate Box</span>
                        <div id="btnLoader" class="loader hidden"></div>
                    </button>
                </div>
            </div>

            <div id="error-msg" class="hidden text-center bg-red-50 border border-red-200 p-4 mb-8 font-mono text-[10px] uppercase tracking-widest text-red-600 font-bold">
                Order not found. Please ensure it is paid and the ID is correct.
            </div>

            <!-- Welcome Info -->
            <div id="welcomeInfo" class="grid grid-cols-1 md:grid-cols-3 gap-6 opacity-60">
                <div class="border border-border-soft p-6 bg-paper/50">
                    <p class="font-mono text-[10px] uppercase text-gold mb-2 font-bold">Phase 01</p>
                    <p class="font-sans text-xs leading-relaxed text-ink/70">Reserve your Surprivo box during pre-sale.</p>
                </div>
                <div class="border border-border-soft p-6 bg-paper/50">
                    <p class="font-mono text-[10px] uppercase text-gold mb-2 font-bold">Phase 02</p>
                    <p class="font-sans text-xs leading-relaxed text-ink/70">We will handpick items based on your Preferences.</p>
                </div>
                <div class="border border-border-soft p-6 bg-paper/50">
                    <p class="font-mono text-[10px] uppercase text-gold mb-2 font-bold">Phase 03</p>
                    <p class="font-sans text-xs leading-relaxed text-ink/70">Track the journey from our studio to your door.</p>
                </div>
            </div>
        </div>

        <!-- Result Section -->
        <div id="tracking-content" class="hidden animate-reveal-card">
            <button onclick="goBack()" class="font-mono text-[10px] uppercase tracking-widest text-gold font-bold mb-6 hover:text-ink transition-colors">‚Üê Search Another</button>
            
            <div class="bg-paper border border-ink shadow-editorial p-8 md:p-12 relative overflow-hidden">
                <!-- Watermark -->
                <div class="absolute -right-8 -top-8 font-display text-9xl text-ink/[0.03] pointer-events-none select-none">SURPRIVO</div>

                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-10 border-b border-border-soft pb-8">
                    <div>
                        <h2 id="user-name" class="font-display text-4xl text-ink mb-1 italic">Hi, Reader</h2>
                        <p id="order-id-label" class="font-mono text-[10px] text-ink/40 uppercase tracking-[0.2em] font-bold">Order #-----</p>
                    </div>
                    <div id="genre-badge" class="bg-ink text-cream px-4 py-2 font-mono text-[10px] uppercase tracking-widest font-bold">‚ú® CURATED</div>
                </div>

                <!-- Status Hero -->
                <div class="mb-12">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <span id="hero-emoji" class="text-3xl">üì¶</span>
                            <h3 id="hero-title" class="font-mono text-sm uppercase tracking-widest font-bold">Status Update</h3>
                        </div>
                        <span id="status-percent" class="font-mono text-xs text-gold font-bold">0%</span>
                    </div>
                    <div class="h-2 w-full bg-cream border border-border-soft rounded-full overflow-hidden">
                        <div id="progress-bar" class="custom-progress h-full bg-gold w-0"></div>
                    </div>
                    <p id="hero-desc" class="mt-6 text-sm text-ink/60 leading-relaxed max-w-md italic">Gathering data...</p>
                </div>

                <!-- Timeline -->
                <div class="space-y-0" id="timeline">
                    <!-- Dynamic -->
                </div>

                <!-- Footer Details -->
                <div class="grid grid-cols-2 gap-8 pt-10 border-t border-border-soft mt-8">
                    <div>
                        <p class="font-mono text-[9px] uppercase tracking-widest text-ink/40 mb-2 font-bold">Delivery Estimate</p>
                        <p id="delivery-date" class="font-sans text-xs font-bold text-ink">March 2026</p>
                    </div>
                    <div>
                        <p class="font-mono text-[9px] uppercase tracking-widest text-ink/40 mb-2 font-bold">Customer Contact</p>
                        <p id="user-phone" class="font-sans text-xs font-bold text-ink">---</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="mt-24 text-center pb-12 w-full max-w-xl border-t border-border-soft pt-12">
        <div class="space-y-2">
            <p class="font-mono text-[10px] text-ink/60 uppercase tracking-widest font-bold">
                ¬© 2026 Surprivo
            </p>
            <p class="font-sans text-[11px] text-ink/40 font-medium tracking-tight">Hand-curated with attention to detail.</p>
        </div>
    </footer>

    <script>
        const BASE_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTrbQw1I0zn-B0jLxHfcdFzlczPE7dBavFD1qM4K34G7niHeJ-ckuBRsv4w9wPvCdHUOpTmguhujBE4/pub?output=csv';

        const STAGE_MAP = {
            "1": { label: "Payment Confirmed", emoji: "üí≥", progress: 10, description: "Your pre-sale slot is secured! We've received your payment." },
            "2": { label: "Analyzing Preferences", emoji: "üîç", progress: 20, description: "Our curators are reviewing your survey answers." },
            "3": { label: "Curating Your Box", emoji: "üìö", progress: 30, description: "Handpicking books based on your vibe." },
            "4": { label: "Quality Assessment", emoji: "‚ú®", progress: 40, description: "Ensuring every book meets our aesthetic standards." },
            "5": { label: "Sourcing Goodies", emoji: "üé®", progress: 50, description: "Adding aesthetic bookmarks and reading guides." },
            "6": { label: "Aesthetic Packing", emoji: "üéÅ", progress: 60, description: "Wrapping your box in signature eco-friendly style." },
            "7": { label: "Ready for Dispatch", emoji: "üè∑Ô∏è", progress: 70, description: "Sealed and labeled. Waiting for courier pickup." },
            "8": { label: "Handed to Courier", emoji: "üöö", progress: 85, description: "The box has left our warehouse!" },
            "9": { label: "In Transit", emoji: "üìç", progress: 95, description: "Traveling to your local hub." },
            "10": { label: "Arrived Home", emoji: "üè†", progress: 100, description: "Delivered! Time for a cozy reading session." }
        };

        // COLUMN MAPPINGS (0-indexed)
        const COL_TIMESTAMP = 0;    // Column A
        const COL_NAME = 2;         // Column C
        const COL_RAW_GENRE = 12;   // Column M
        const COL_PHONE = 14;       // Column P
        const COL_STAGE_VALUE = 21; // Column V
        const COL_EXPECTED_DATE = 22; // Column W
        const COL_TRACK_ID = 26;    // Column AA
        const COL_ORDER_STATUS = 28; // Column AC

        function trackOrder() {
            const inputId = document.getElementById('orderInput').value.trim();
            if (!inputId) return;

            const error = document.getElementById('error-msg');
            const btnLoader = document.getElementById('btnLoader');
            const trackBtn = document.getElementById('trackBtn');
            
            error.classList.add('hidden');
            btnLoader.classList.remove('hidden');
            trackBtn.disabled = true;

            const cacheBuster = "&t=" + new Date().getTime();
            const fetchUrl = BASE_CSV_URL + cacheBuster;

            Papa.parse(fetchUrl, {
                download: true,
                header: false,
                complete: function(results) {
                    btnLoader.classList.add('hidden');
                    trackBtn.disabled = false;
                    
                    const rows = results.data;
                    let foundUser = null;

for (let i = 1; i < rows.length; i++) {
    const row = rows[i];
    const orderIdInSheet = (row[COL_ORDER_ID] || "").toString().trim();
    const orderStatus = (row[COL_ORDER_STATUS] || "").toString().trim().toLowerCase();
    
    // Match Order ID AND check if status is created/paid
    if (orderIdInSheet === inputId && (orderStatus === "created" || orderStatus === "paid")) {
        let stageValue = (row[COL_STAGE_VALUE] || "").toString().trim();
        if (!stageValue) stageValue = "1";

        const timestamp = row[COL_TIMESTAMP] || "";
        
        let rawGenre = row[COL_RAW_GENRE] || "Curated";
        let cleanGenre = rawGenre.split('-')[0].replace("The", "").replace("Box", "").trim();

        foundUser = {
            order_id: orderIdInSheet,
            name: row[COL_NAME] || "Reader",
            phone: row[COL_PHONE] || "---",
            expectedDate: row[COL_EXPECTED_DATE] || "March 2026",
            genre: cleanGenre.toUpperCase(),
            orderDate: timestamp.split(' ')[0],
            stageNum: parseInt(stageValue)
        };
        break;
    }
}
